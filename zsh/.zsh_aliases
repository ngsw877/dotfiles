###### 基本エイリアス #######
alias c="clear"
alias e="exit"
alias "e?"="echo $?"
alias h="history 1"
alias l="ls"
alias la="ls -a"
alias ll="ls -l"
alias lla="ls -al"
alias digs="dig +short"

alias zrc="vi ~/.zshrc"
alias szrc="source ~/.zshrc"
alias zali="vi ~/.zsh_aliases"

###### ツール系 ######
alias k="kubectl"
alias ccu="ccusage"

### Terraform ###
alias tf="terraform"

# tnm (Terraform New Module)
# Terraformモジュールの雛形ファイル (main.tf, variables.tf, outputs.tf) を生成する
#
# Usage:
#   tnm           → カレントディレクトリに3ファイルを作成
#   tnm <name>    → カレントディレクトリに <name>/ を作成し、その中に3ファイルを作成
terraform_new_module() {
  local module_name="$1"
  local base_dir="$PWD"
  local target_dir="$base_dir"

  if [ -n "$module_name" ]; then
    target_dir="$base_dir/$module_name"
    mkdir -p "$target_dir"
  fi

  touch "$target_dir/main.tf" "$target_dir/variables.tf" "$target_dir/outputs.tf"
  echo "Created Terraform module at: $target_dir"
}

alias tnm='terraform_new_module'


### AWS ###
alias p='function _aws_profile() { export AWS_PROFILE="$1"; }; _aws_profile'
alias sso='function _aws_sso() { aws sso login --profile "$1"; }; _aws_sso'
alias rb='aws s3 rb --force'

###git command###
alias gs='git status'
alias gc='git commit'
alias gca='git commit --amend'
alias gd='git diff'
alias gds='git diff --staged'
alias gf='git fetch'
alias gcm='git commit -m'
alias gco='git checkout'
alias gcob='git checkout -b'
alias ga='git add'
alias gcod='git checkout develop'
alias gcom='git checkout main'
alias gpo='git push origin'
alias gpom='git push origin main'
alias gpl='git pull'
alias gplo='git pull origin'
alias gplod='git pull origin develop'
alias gplom='git pull origin main'
alias gss='git stash -u'
alias gssl='git stash list'
alias gssp='git stash pop'
alias gsw='git switch'
alias gswc='git switch -c'
alias grmc='git rm -r --cached'
alias grs='git restore'
alias grss='git restore --staged'
alias gcl='git clean -df'
alias grc='git restore . && git clean -df'
alias gb='git branch'
alias gbd='git branch -d'
alias gbD='git branch -D'
alias gbc='git branch --contains'
alias gl1='git log --oneline -n'
# 現在のブランチの親ブランチを出力 https://qiita.com/upinetree/items/0b74b08b64442f0a89b9
alias gp='git show-branch | grep "*" | grep -v "$(git rev-parse --abbrev-ref HEAD)" | head -1 | awk -F"[]~^[]" '\''{print $2}'\'
alias gsu='git submodule update'
alias gsur='git submodule update --remote'

### docker ###
alias d='docker'
alias ds='docker stop $(docker ps -q)'
alias di='docker image'
alias dcon='docker container'
alias dv='docker volume'
alias dc='docker compose'
alias dcp='docker compose ps'
alias dce='docker compose exec'
alias dcr='docker compose restart'
alias dcu='docker compose up -d && docker compose ps'
alias dcub='docker compose up -d --build'
alias dcs='docker compose stop'

### npm ###
alias ni='npm install'
alias nrd='npm run dev'
alias nrw='npm run watch'
alias nrwp='npm run watch-poll'
alias nrs='npm run serve'

### yarn ###
alias yi='yarn install'
alias yd='yarn dev'

### Laravel Sail ###
alias sail='[ -f sail ] && bash sail || bash vendor/bin/sail'

###### function ######

function mkcd() {
    mkdir $@ && cd `echo $@ | sed -e "s/-[^ \f\n\r\t]*//g"`
}


# delete-merged-branch
PROTECT_BRANCHES='master|main|develop'

git-delete-merged-branch() {
    git fetch --prune
    git branch --merged | egrep -v "\*|${PROTECT_BRANCHES}" | xargs git branch -d
}

alias gdmb='git-delete-merged-branch'
